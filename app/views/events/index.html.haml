<script src="//maps.google.com/maps/api/js?key=AIzaSyBWIZdVc2TCRJ7bnJRzNrRbSGDynUPzpA4"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
%p#notice= notice
%h1 Events
%table
  %thead
    %tr
      %th Author
      %th Title
      %th Description
      %th Date time
      %th Latitude
      %th Longitude
      %th Private
      %th{:colspan => "3"}
  %tbody
  .devise
    - if user_signed_in?
      %span Здравствуйте,
      = current_user.email
      = link_to 'Выйти', destroy_user_session_path, method: :delete, data: { confirm: 'Вы точно хотите выйти?' }
    - else
      = link_to 'Войти', new_user_session_path 
      %span или
      = link_to 'Зарегистрироваться', new_user_registration_path

    - @events.each do |event|
      %tr
        %td= event.author
        %td= event.title
        %td= event.description
        %td= event.date_time
        %td= event.latitude
        %td= event.longitude
        %td= event.private
        %td= event.contacts
        %td= link_to 'Show', event
        %td= link_to 'Edit', edit_event_path(event)
        %td= link_to 'Destroy', event, method: :delete, data: { confirm: 'Are you sure?' }
%br/
= link_to 'New Event', new_event_path
.map{style: 'width: 800px;'}
  #map{style: 'width: 800px; height: 400px;'}
  :javascript   
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {styles:[
    {
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#ebe3cd"
    }
    ]
    },
    {
    "elementType": "labels.text.fill",
    "stylers": [
    {
    "color": "#523735"
    }
    ]
    },
    {
    "elementType": "labels.text.stroke",
    "stylers": [
    {
    "color": "#f5f1e6"
    }
    ]
    },
    {
    "featureType": "administrative",
    "elementType": "geometry.stroke",
    "stylers": [
    {
    "color": "#c9b2a6"
    }
    ]
    },
    {
    "featureType": "administrative.land_parcel",
    "elementType": "geometry.stroke",
    "stylers": [
    {
    "color": "#dcd2be"
    }
    ]
    },
    {
    "featureType": "administrative.land_parcel",
    "elementType": "labels.text.fill",
    "stylers": [
    {
    "color": "#ae9e90"
    }
    ]
    },
    {
    "featureType": "landscape.natural",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#dfd2ae"
    }
    ]
    },
    {
    "featureType": "poi",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#dfd2ae"
    }
    ]
    },
    {
    "featureType": "poi",
    "elementType": "labels.text.fill",
    "stylers": [
    {
    "color": "#93817c"
    }
    ]
    },
    {
    "featureType": "poi.park",
    "elementType": "geometry.fill",
    "stylers": [
    {
    "color": "#a5b076"
    }
    ]
    },
    {
    "featureType": "poi.park",
    "elementType": "labels.text.fill",
    "stylers": [
    {
    "color": "#447530"
    }
    ]
    },
    {
    "featureType": "road",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#f5f1e6"
    }
    ]
    },
    {
    "featureType": "road.arterial",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#fdfcf8"
    }
    ]
    },
    {
    "featureType": "road.highway",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#f8c967"
    }
    ]
    },
    {
    "featureType": "road.highway",
    "elementType": "geometry.stroke",
    "stylers": [
    {
    "color": "#e9bc62"
    }
    ]
    },
    {
    "featureType": "road.highway.controlled_access",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#e98d58"
    }
    ]
    },
    {
    "featureType": "road.highway.controlled_access",
    "elementType": "geometry.stroke",
    "stylers": [
    {
    "color": "#db8555"
    }
    ]
    },
    {
    "featureType": "road.local",
    "elementType": "labels.text.fill",
    "stylers": [
    {
    "color": "#806b63"
    }
    ]
    },
    {
    "featureType": "transit.line",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#dfd2ae"
    }
    ]
    },
    {
    "featureType": "transit.line",
    "elementType": "labels.text.fill",
    "stylers": [
    {
    "color": "#8f7d77"
    }
    ]
    },
    {
    "featureType": "transit.line",
    "elementType": "labels.text.stroke",
    "stylers": [
    {
    "color": "#ebe3cd"
    }
    ]
    },
    {
    "featureType": "transit.station",
    "elementType": "geometry",
    "stylers": [
    {
    "color": "#dfd2ae"
    }
    ]
    },
    {
    "featureType": "water",
    "elementType": "geometry.fill",
    "stylers": [
    {
    "color": "#b9d3c2"
    }
    ]
    },
    {
    "featureType": "water",
    "elementType": "labels.text.fill",
    "stylers": [
    {
    "color": "#92998d"
    }
    ]
    }
    ]

    }, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers(#{raw @hash.to_json});
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });

